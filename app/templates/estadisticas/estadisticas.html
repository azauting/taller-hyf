{% extends 'menu/sidebar.html' %}
{% block title %}Estadísticas - HYF{% endblock %}
{% block header %}Estadísticas KPIS{% endblock %}

{% block content %}
<!-- Contenedor principal -->
<div class="bg-hyf-light rounded-md shadow-lg overflow-hidden font-sans p-4">
    
    <!-- Sección de KPIs -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <!-- KPI 1 -->
        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold text-gray-700">Valor del Inventario</h3>
            <p class="text-2xl font-bold text-blue-600">${{ "{0:,.0f}".format(valor_inventario).replace(",", ".") }} CLP</p>
        </div>
        
        <!-- KPI 2 -->
        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold text-gray-700">Tickets Servicio</h3>
            <p class="text-2xl font-bold text-green-600">${{ "{0:,.0f}".format(tickets_servicio).replace(",", ".") }} CLP</p>
        </div>
        
        <!-- KPI 3 -->
        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold text-gray-700">Tickets Repuestos</h3>
            <p class="text-2xl font-bold text-purple-600">${{ "{0:,.0f}".format(tickets_repuestos).replace(",", ".") }} CLP</p>
        </div>
        
        <!-- KPI 4 -->
        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold text-gray-700">Utilidad Global</h3>
            <p class="text-2xl font-bold {% if utilidad_global >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
                ${{ "{0:,.0f}".format(utilidad_global).replace(",", ".") }} CLP
            </p>
            <p class="text-sm text-gray-500">
                Inversión: ${{ "{0:,.0f}".format(costo_inversion).replace(",", ".") }} CLP | Ingresos: ${{ "{0:,.0f}".format(ingresos_totales).replace(",", ".") }} CLP
            </p>
        </div>
    </div>

    <!-- Filtro por mes y año -->
    <div class="bg-white p-4 rounded shadow mb-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar ganancias por mes y año</h3>
        <form method="get" action="{{ url_for('estadisticas.ver_estadisticas') }}" class="flex flex-col md:flex-row gap-4">
            <select name="mes" class="border rounded p-2">
                {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if mes == m %}selected{% endif %}>
                        {{ m }}
                    </option>
                {% endfor %}
            </select>
            <select name="ano" class="border rounded p-2">
                {% for y in range(2020, current_year + 1) %}
                    <option value="{{ y }}" {% if ano == y %}selected{% endif %}>
                        {{ y }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Filtrar</button>
        </form>
    </div>

    {% if total_filtrado is not none %}
    <div class="bg-green-100 p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-700">Ganancias en {{ mes }}/{{ ano }}</h3>
        <p class="text-2xl font-bold text-green-700">
            ${{ "{0:,.0f}".format(total_filtrado).replace(",", ".") }} CLP
        </p>
    </div>
    {% endif %}

</div>
{% endblock %}
