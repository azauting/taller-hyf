{% extends 'menu/sidebar.html' %}
{% block title %}Tickets - HYF{% endblock %}
{% block header %}Vehiculos y repuestos en el taller{% endblock %}

{% block content %}
<div class="mx-auto px-2">
    <div class="flex justify-center mb-4">
        <!-- Selector (menu)-->
        <div class="inline-flex rounded-lg overflow-hidden shadow-md border border-hyf-primary" role="group">
            <button id="btn-vehiculos" type="button" class="flex items-center gap-2 px-5 py-2 text-sm font-medium 
                bg-hyf-primary text-white 
                hover:bg-hyf-primary/90 
                focus:outline-none focus:ring-2 focus:ring-hyf-accent 
                transition-colors duration-200">
                <i class="fas fa-car"></i>
                Vehículos ({{ tickets_vehiculo|length }})
            </button>
            <button id="btn-repuestos" type="button" class="flex items-center gap-2 px-5 py-2 text-sm font-medium 
                bg-hyf-light text-hyf-primary 
                hover:bg-hyf-secondary hover:text-white 
                focus:outline-none focus:ring-2 focus:ring-hyf-accent 
                transition-colors duration-200">
                <i class="fas fa-cogs"></i>
                Repuestos ({{ tickets_repuesto|length }})
            </button>
        </div>
    </div>
    <!-- Vehículos -->
    <section id="seccion-vehiculos">
        {% if tickets_vehiculo %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for ticket in tickets_vehiculo %}
            {% set patente_formateada = ticket.vehiculo.patente[:2] + '-' + ticket.vehiculo.patente[2:4] + '-' +
            ticket.vehiculo.patente[4:] %}
            <div
                class="bg-hyf-primary rounded-lg border border-gray-100 shadow-sm hover:shadow-lg hover:scale-105 duration-100 ease-in">
                <!-- Encabezado -->
                <div class="flex justify-between items-center p-4 border-b border-gray-100">
                    <div class="flex items-center gap-3">
                        <div class="p-2">
                            <i class="fas fa-car text-3xl text-white"></i>
                        </div>
                        <p
                            class="bg-white text-hyf-primary inline-block px-2 py-1 text-xl font-mono font-bold rounded border border-gray-200 uppercase">
                            {{ patente_formateada }}
                        </p>
                    </div>
                    <span class="px-2.5 py-1 rounded-full text-xs font-medium
                        {% if ticket.estado_pago == 'Pagado' %}
                            bg-green-100 text-green-700
                        {% else %}
                            bg-red-500 text-white
                        {% endif %}">
                        {{ ticket.estado_pago }}
                    </span>
                </div>
                <!-- Contenido -->
                <div class="flex flex-col gap-2 px-4 py-2">
                    <div>
                        <p class="text-sm font-semibold text-gray-200">Ticket #{{ ticket.id }}</p>
                        <p class="text-lg text-white">{{ ticket.fecha_creacion.strftime('%d/%m/%Y') }}</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-gray-200">Vehiculo</p>
                        <p class="text-lg text-white">{{ ticket.vehiculo.marca }} {{
                            ticket.vehiculo.modelo }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-200">Motivo</p>
                        <p class="text-lg text-white">{{ ticket.motivo|truncate(100) }}</p>
                    </div>
                </div>

                <!-- Footer -->
                <div class="px-4 py-3 border-t border-gray-100 bg-hyf-primary rounded-b-xl text-center">
                    <a href="{{ url_for('ticket_servicio.ticket_servicio_ver', ticket_id=ticket.id) }}"
                        class="inline-flex items-center text-sm font-medium text-white hover:text-hyf-accent transition-colors">
                        Ver detalles
                        <i class="fas fa-chevron-right ml-1 text-xs"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-gray-50 rounded-lg p-8 text-center border border-gray-200">
            <i class="fas fa-car text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-600 font-medium mb-1">No hay vehículos en taller</p>
            <p class="text-sm text-gray-500">Todos los tickets están completados</p>
        </div>
        {% endif %}
    </section>

    <!-- Repuestos -->
    <section id="seccion-repuestos" class="hidden">
        {% if tickets_repuesto %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for ticket in tickets_repuesto %}
            <div
                class="bg-hyf-primary rounded-lg border border-gray-100 shadow-sm hover:shadow-lg hover:scale-[1.01] transition-all duration-200">
                <!-- Encabezado -->
                <div class="flex justify-between items-center p-4 border-b border-gray-100">
                    <div class="flex items-center gap-3">
                        <div class="p-2">
                            <i class="fas fa-cog text-3xl text-white"></i>
                        </div>
                        <p
                            class="bg-white text-hyf-primary inline-block px-2 py-1 text-xl font-mono font-bold rounded border border-gray-200 uppercase">
                            {{ ticket.tipo_repuesto}}
                        </p>
                    </div>
                    <span class="px-2.5 py-1 rounded-full text-xs font-medium
                        {% if ticket.estado_pago == 'Pagado' %}
                            bg-green-100 text-green-700
                        {% else %}
                            bg-red-500 text-white
                        {% endif %}">
                        {{ ticket.estado_pago }}
                    </span>
                </div>
                <!-- Contenido -->
                <div class="flex flex-col gap-2 px-4 py-2">
                    <div>
                        <p class="text-sm font-semibold text-gray-200">Ticket #{{ ticket.id }}</p>
                        <p class="text-lg text-white">{{ ticket.fecha_creacion.strftime('%d/%m/%Y') }}</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-gray-200">Tamaño</p>
                        <p class="text-lg text-white">{{ ticket.tamano }}</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-gray-200">Cantidad</p>
                        <p class="text-lg text-white">{{ ticket.cantidad}}</p>
                    </div>
                </div>

                <!-- Footer -->
                <div class="px-4 py-3 border-t border-gray-100 bg-hyf-primary rounded-b-xl text-center">
                    <a href="{{ url_for('ticket_repuesto.ticket_repuesto_ver', ticket_id=ticket.id) }}"
                        class="inline-flex items-center text-sm font-medium text-white hover:text-hyf-accent transition-colors">
                        Ver detalles
                        <i class="fas fa-chevron-right ml-1 text-xs"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-gray-50 rounded-lg p-8 text-center border border-gray-200">
            <i class="fas fa-box-open text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-600 font-medium mb-1">No hay repuestos en taller</p>
            <p class="text-sm text-gray-500">Todos los pedidos están completados</p>
        </div>
        {% endif %}
    </section>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const btnVehiculos = document.getElementById('btn-vehiculos');
        const btnRepuestos = document.getElementById('btn-repuestos');
        const seccionVehiculos = document.getElementById('seccion-vehiculos');
        const seccionRepuestos = document.getElementById('seccion-repuestos');

        function cambiarVista(activa) {
            if (activa === 'vehiculos') {
                // Mostrar vehículos
                seccionVehiculos.classList.remove('hidden');
                seccionRepuestos.classList.add('hidden');

                // Botón activo
                btnVehiculos.classList.remove('bg-hyf-light', 'text-hyf-primary', 'hover:bg-hyf-secondary', 'hover:text-white');
                btnVehiculos.classList.add('bg-hyf-primary', 'text-white', 'hover:bg-hyf-primary/90');

                // Botón inactivo
                btnRepuestos.classList.remove('bg-hyf-primary', 'text-white', 'hover:bg-hyf-primary/90');
                btnRepuestos.classList.add('bg-hyf-light', 'text-hyf-primary', 'hover:bg-hyf-secondary', 'hover:text-white');
            } else {
                // Mostrar repuestos
                seccionVehiculos.classList.add('hidden');
                seccionRepuestos.classList.remove('hidden');

                // Botón activo
                btnRepuestos.classList.remove('bg-hyf-light', 'text-hyf-primary', 'hover:bg-hyf-secondary', 'hover:text-white');
                btnRepuestos.classList.add('bg-hyf-primary', 'text-white', 'hover:bg-hyf-primary/90');

                // Botón inactivo
                btnVehiculos.classList.remove('bg-hyf-primary', 'text-white', 'hover:bg-hyf-primary/90');
                btnVehiculos.classList.add('bg-hyf-light', 'text-hyf-primary', 'hover:bg-hyf-secondary', 'hover:text-white');
            }
        }

        btnVehiculos.addEventListener('click', () => cambiarVista('vehiculos'));
        btnRepuestos.addEventListener('click', () => cambiarVista('repuestos'));
    });
</script>

{% endblock %}